<!doctype html>
<html lang="en">
<head>
<link rel="icon" href="./kimsze_sharp16.ico?v=20260111a" sizes="any">
<link rel="shortcut icon" href="./kimsze_sharp16.ico?v=20260111a">
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>P1 Compare Numbers (1–9999) — Place Value Discs + Unequal Signs</title>

  <style>
    :root{
      --bg:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e2e8f0;

      /* column tints */
      --colThBg:#e7f4e7;  /* thousands light green */
      --colHBg:#fde7f0;   /* hundreds light pink */
      --colTBg:#ffeede;   /* tens light peach */
      --colOBg:#e6f1ff;   /* ones light blue */

      /* disc colors */
      --discTh:#37b24d;   /* green */
      --discH:#ff7ab6;    /* pink */
      --discT:#f6a21a;    /* orange */
      --discO:#4d8dff;    /* blue */

      --input:#e8f6df;
      --inputLine:#9bbf87;

      --radius:22px;
      --shadow:0 14px 40px rgba(2,6,23,.10);

      --drawerW:min(420px, 92vw);

      /* stage base size (auto-scaled; no scrolling) */
      --baseW: 980;
      --baseH: 690;

      /* fonts */
      --S-title: 34px;
      --S-pvLabel: 22px;
      --S-pvValue: 24px;
      --S-row: 26px;

      /* ✅ discs 20% smaller by default (sliders set these too) */
      --discBig: 45px;   /* was 56 */
      --discMed: 42px;   /* was 52 */
      --discSmall: 37px; /* was 46 */

      /* ✅ vertical stacks (5 left, 4 right) spacing */
      --stackColGap: 10px;
      --stackRowGap: 10px;
    }

    *{box-sizing:border-box}
    html, body{
      height:100%;
      margin:0;
      overflow:hidden;
      overscroll-behavior:none;
      background:var(--bg);
      color:var(--ink);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", sans-serif;
    }

    body.drawer-open .viewport{
      padding-right: calc(var(--drawerW) + 10px);
    }

    .viewport{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 10px;
    }
    .stage{
      width: calc(var(--baseW) * 1px);
      height: calc(var(--baseH) * 1px);
      transform-origin: top left;
      background:#fff;
      border-radius: 18px;
      position:relative;
    }

    .wrap{
      width:100%;
      height:100%;
      padding: 14px 16px 12px;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .topbar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }

    .titleLine{
      display:flex;
      align-items:flex-end;
      gap: 10px;
      flex-wrap:wrap;
    }
    .titleText{
      font-size: var(--S-title);
      font-weight: 900;
      line-height: 1.02;
      margin:0;
      letter-spacing:.2px;
    }
    .hdrBlank{
      width: 118px;
      height: 54px;
      border-radius: 16px;
      border: 3px solid var(--inputLine);
      background: var(--input);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: 30px;
      font-weight: 900;
      color: rgba(15,23,42,.95);
      user-select:none;
    }

    .settingsBtn{
      border:1px solid var(--line);
      background:#fff;
      color:var(--ink);
      border-radius:999px;
      padding:10px 14px;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 18px rgba(2,6,23,.06);
      white-space:nowrap;
      height: 44px;
      align-self:flex-start;
    }
    .settingsBtn:active{ transform: translateY(1px); }

    .floatGear{
      position:absolute;
      right: 14px;
      bottom: 14px;
      z-index: 5;
      width: 56px;
      height: 56px;
      border-radius: 18px;
      border:1px solid var(--line);
      background:#fff;
      box-shadow: 0 14px 30px rgba(2,6,23,.14);
      cursor:pointer;
      font-size: 22px;
      font-weight: 900;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .floatGear:active{ transform: translateY(1px); }

    .grid{
      flex: 1;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      align-items:stretch;
      min-height: 0;
    }

    .side{
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      background:#fff;
      padding: 12px 12px 10px;
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    /* 4 columns of place value discs */
    .blocks{
      flex: 1;
      min-height: 0;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      gap: 10px;
      align-items:stretch;
      padding: 6px 6px 6px;
    }

    .pvCol{
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(2,6,23,.08);
      display:flex;
      flex-direction:column;
      min-height: 0;
      background:#fff;
    }
    .pvCol.th{ background: var(--colThBg); }
    .pvCol.h { background: var(--colHBg); }
    .pvCol.t { background: var(--colTBg); }
    .pvCol.o { background: var(--colOBg); }

    /* two vertical stacks (5 left, 4 right) */
    .colInner{
      flex: 1;
      min-height: 0;
      padding: 10px 8px;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--stackColGap);
      align-items:end;
      justify-items:center;
      overflow:hidden;
    }
    .stackCol{
      width:100%;
      display:flex;
      flex-direction: column-reverse; /* stack from bottom up */
      gap: var(--stackRowGap);
      align-items:center;
      justify-content:flex-start;
      min-height: 0;
    }

    /* Per-column disc size (max size; JS may auto-fit smaller) */
    .pvCol.th .colInner{ --discS: var(--discBig); }
    .pvCol.h  .colInner{ --discS: var(--discBig); }
    .pvCol.t  .colInner{ --discS: var(--discMed); }
    .pvCol.o  .colInner{ --discS: var(--discSmall); }

    /* place-value summary card */
    .pvCard{
      border-radius: 24px;
      overflow:hidden;
      border:2px solid #cbd5e1;
      background:#fff;
      display:grid;
      grid-template-columns: 1fr 1fr 1fr 1fr;
      margin-top: 10px;
    }
    .pvCell{
      padding: 8px 8px 8px;
      display:flex;
      flex-direction:column;
      gap: 6px;
      align-items:center;
      justify-content:center;
      min-height: 92px;
      border-right: 1px solid rgba(2,6,23,.08);
    }
    .pvCell:last-child{ border-right: 0; }
    .pvCell.th{ background: linear-gradient(180deg, #bff0c8 0%, var(--colThBg) 100%); }
    .pvCell.h { background: linear-gradient(180deg, #ffc0dc 0%, var(--colHBg) 100%); }
    .pvCell.t { background: linear-gradient(180deg, #ffd7a7 0%, var(--colTBg) 100%); }
    .pvCell.o { background: linear-gradient(180deg, #bcd6ff 0%, var(--colOBg) 100%); }

    .pvLabel{
      font-weight: 900;
      font-size: var(--S-pvLabel);
      letter-spacing:.3px;
      text-shadow: 0 2px 0 rgba(255,255,255,.35);
    }

    .pvValue{
      width: 74px;
      height: 44px;
      border-radius: 14px;
      border: 3px solid rgba(2,6,23,.12);
      background: rgba(255,255,255,.75);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size: var(--S-pvValue);
      font-weight: 900;
    }
    .pvValue.editable{
      border-color: var(--inputLine);
      background: var(--input);
    }
    .pvInput{
      width:100%;
      height:100%;
      border:0;
      outline:none;
      background:transparent;
      text-align:center;
      font-size: var(--S-pvValue);
      font-weight: 900;
    }

    .answers{
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding: 10px 12px 8px;
      background:#fff;
      box-shadow: var(--shadow);
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      gap: 10px;
      font-size: var(--S-row);
      font-weight: 900;
      margin: 6px 0;
    }

    .ineq{
      font-size: 32px;
      font-weight: 1000;
      line-height: 1;
      padding: 0 2px;
      user-select:none;
    }

    .blank{
      width: 150px;
      height: 56px;
      border-radius: 16px;
      border: 3px solid var(--inputLine);
      background: var(--input);
      font-size: 30px;
      font-weight: 900;
      text-align:center;
      outline:none;
    }
    .blank.good{ border-color:#16a34a; box-shadow: 0 0 0 4px rgba(34,197,94,.15); }
    .blank.bad{ border-color:#ef4444; box-shadow: 0 0 0 4px rgba(239,68,68,.14); }

    .pvValue.good{
      border-color:#16a34a !important;
      box-shadow: 0 0 0 4px rgba(34,197,94,.15);
    }
    .pvValue.bad{
      border-color:#ef4444 !important;
      box-shadow: 0 0 0 4px rgba(239,68,68,.14);
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin-top: 8px;
    }
    .btn{
      border:1px solid var(--line);
      background:#fff;
      border-radius: 14px;
      padding: 10px 14px;
      font-weight: 900;
      cursor:pointer;
      box-shadow: 0 10px 20px rgba(2,6,23,.08);
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      border-color: transparent;
      background: linear-gradient(180deg, #22c55e 0%, #16a34a 100%);
      color:#fff;
    }
    .btn.toggle-on{
      border-color:#16a34a;
      box-shadow: 0 10px 20px rgba(2,6,23,.08), 0 0 0 4px rgba(34,197,94,.12);
    }

    .msg{ font-weight: 800; color: var(--muted); }

    .credit{
      text-align:right;
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }

    /* Disc takes size from column's --discS */
    .disc{
      width: var(--discS);
      height: var(--discS);
      border-radius: 999px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight: 1000;
      color: rgba(15,23,42,.95);
      background: #fff;
      border: 3px solid rgba(2,6,23,.12);
      box-shadow: 0 10px 18px rgba(2,6,23,.10);
      user-select:none;
      flex: 0 0 auto;
    }

    .disc.th{ background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.10)), var(--discTh); border-color: rgba(7,94,36,.35); }
    .disc.h { background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.10)), var(--discH);  border-color: rgba(136,22,74,.28); }
    .disc.t { background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.10)), var(--discT);  border-color: rgba(122,73,0,.30); }
    .disc.o { background: linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.10)), var(--discO);  border-color: rgba(0,49,120,.28); }

    /* ✅ keep text readable as discs shrink */
    .disc span{
      filter: drop-shadow(0 2px 0 rgba(255,255,255,.35));
      font-size: clamp(12px, calc(var(--discS) * 0.34), 18px);
      line-height: 1;
    }

    /* Teacher drawer */
    .drawerOverlay{
      position:fixed; inset:0;
      background: rgba(0,0,0,0);
      display:none;
      z-index: 50;
    }
    .drawer{
      position:fixed; top:0; right:0; height:100%;
      width: var(--drawerW);
      background:#fff;
      border-left:1px solid var(--line);
      box-shadow: -20px 0 60px rgba(2,6,23,.25);
      transform: translateX(100%);
      transition: transform .22s ease;
      z-index: 60;
      display:flex;
      flex-direction:column;
    }
    .drawerOverlay.show{ display:block; }
    .drawer.show{ transform: translateX(0); }

    .drawerTop{
      position:sticky; top:0;
      background:#fff;
      border-bottom:1px solid var(--line);
      padding: 12px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      z-index:2;
    }
    .drawerTop h2{ margin:0; font-size: 16px; letter-spacing:.2px; }
    .closeBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius: 12px;
      padding: 8px 10px;
      font-weight: 900;
      cursor:pointer;
    }
    .drawerBody{ padding: 14px; overflow:auto; }

    .field{
      border:1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      margin-bottom: 12px;
      background:#fafafa;
    }
    .field label{ display:block; font-weight: 900; margin-bottom: 6px; }
    .help{ color: var(--muted); font-size: 12px; line-height: 1.35; margin-top: 6px; }
    .numRow{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .setNum{
      width: 160px;
      height: 46px;
      border-radius: 12px;
      border:1px solid #cbd5e1;
      padding: 0 10px;
      font-size: 16px;
      font-weight: 800;
      outline:none;
      background:#fff;
    }

    .toggleRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 0 2px;
    }
    .toggleRow span{ font-weight: 900; }
    .switch{
      appearance:none;
      width: 54px;
      height: 30px;
      border-radius: 999px;
      background: #e2e8f0;
      border:1px solid #cbd5e1;
      position:relative;
      cursor:pointer;
      outline:none;
    }
    .switch::after{
      content:"";
      width: 24px; height: 24px;
      border-radius:999px;
      background:#fff;
      box-shadow: 0 8px 18px rgba(2,6,23,.18);
      position:absolute;
      left: 3px; top: 2px;
      transition: transform .18s ease;
    }
    .switch:checked{ background: #22c55e; border-color:#16a34a; }
    .switch:checked::after{ transform: translateX(24px); }

    .sliderRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items:center;
      margin-top: 8px;
    }
    input[type="range"]{ width:100%; }
    .pill{
      font-weight:900;
      font-size:12px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid #cbd5e1;
      background:#fff;
      white-space:nowrap;
    }
  </style>
</head>

<body>
  <div class="viewport">
    <div class="stage" id="stage">
      <div class="wrap">
        <div class="topbar">
          <div class="titleLine">
            <div class="titleText">Compare</div>
            <div class="hdrBlank" id="hdrA">???</div>
            <div class="titleText">and</div>
            <div class="hdrBlank" id="hdrB">???</div>
            <div class="titleText">.</div>
          </div>
          <button class="settingsBtn" id="openSettings">⚙️ Teacher Settings</button>
        </div>

        <div class="grid">
          <!-- LEFT -->
          <div class="side">
            <div class="blocks">
              <div class="pvCol th"><div class="colInner" id="leftThousands"></div></div>
              <div class="pvCol h"><div class="colInner" id="leftHundreds"></div></div>
              <div class="pvCol t"><div class="colInner" id="leftTens"></div></div>
              <div class="pvCol o"><div class="colInner" id="leftOnes"></div></div>
            </div>

            <div class="pvCard">
              <div class="pvCell th">
                <div class="pvLabel">Thousands</div>
                <div class="pvValue" id="leftThVal"></div>
              </div>
              <div class="pvCell h">
                <div class="pvLabel">Hundreds</div>
                <div class="pvValue" id="leftHundVal"></div>
              </div>
              <div class="pvCell t">
                <div class="pvLabel">Tens</div>
                <div class="pvValue" id="leftTensVal"></div>
              </div>
              <div class="pvCell o">
                <div class="pvLabel">Ones</div>
                <div class="pvValue" id="leftOnesVal"></div>
              </div>
            </div>
          </div>

          <!-- RIGHT -->
          <div class="side">
            <div class="blocks">
              <div class="pvCol th"><div class="colInner" id="rightThousands"></div></div>
              <div class="pvCol h"><div class="colInner" id="rightHundreds"></div></div>
              <div class="pvCol t"><div class="colInner" id="rightTens"></div></div>
              <div class="pvCol o"><div class="colInner" id="rightOnes"></div></div>
            </div>

            <div class="pvCard">
              <div class="pvCell th">
                <div class="pvLabel">Thousands</div>
                <div class="pvValue" id="rightThVal"></div>
              </div>
              <div class="pvCell h">
                <div class="pvLabel">Hundreds</div>
                <div class="pvValue" id="rightHundVal"></div>
              </div>
              <div class="pvCell t">
                <div class="pvLabel">Tens</div>
                <div class="pvValue" id="rightTensVal"></div>
              </div>
              <div class="pvCell o">
                <div class="pvLabel">Ones</div>
                <div class="pvValue" id="rightOnesVal"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="answers">
          <div class="row">
            <input class="blank" id="gtA" inputmode="numeric" maxlength="4" aria-label="Greater-than left number">
            <span class="ineq">&gt;</span>
            <input class="blank" id="gtB" inputmode="numeric" maxlength="4" aria-label="Greater-than right number">
          </div>

          <div class="row">
            <input class="blank" id="ltA" inputmode="numeric" maxlength="4" aria-label="Less-than left number">
            <span class="ineq">&lt;</span>
            <input class="blank" id="ltB" inputmode="numeric" maxlength="4" aria-label="Less-than right number">
          </div>

          <div class="btnRow">
            <button class="btn primary" id="checkBtn">Check</button>

            <button class="btn" id="quickRandomBtn" title="New random numbers">Random</button>
            <button class="btn" id="quickHeaderBtn" title="Toggle header reveal">Reveal header</button>
            <button class="btn" id="quickPVBtn" title="Toggle place-value reveal">Reveal place values</button>

            <button class="btn" id="clearBtn">Clear</button>
            <span class="msg" id="msg"></span>
          </div>

          <div class="credit">Designed by Lim Kim Sze © 2026</div>
        </div>

        <button class="floatGear" id="openSettings2" aria-label="Open teacher settings">⚙️</button>
      </div>
    </div>
  </div>

  <div class="drawerOverlay" id="overlay" tabindex="-1" aria-hidden="true"></div>
  <aside class="drawer" id="drawer" aria-label="Teacher Settings Panel">
    <div class="drawerTop">
      <h2>Teacher Settings</h2>
      <button class="closeBtn" id="closeSettings">Close ✕</button>
    </div>
    <div class="drawerBody">
      <div class="field">
        <label>Set the two numbers (1–9999)</label>
        <div class="numRow">
          <input class="setNum" id="setLeft" type="number" min="1" max="9999" step="1" value="3250">
          <input class="setNum" id="setRight" type="number" min="1" max="9999" step="1" value="2500">
          <button class="btn" id="applyBtn">Apply</button>
          <button class="btn" id="randomBtn">Random</button>
        </div>
        <div class="help">Numbers can be 1-digit up to 4-digit. If both numbers are the same, the right number will be nudged by 1.</div>
      </div>

      <div class="field">
        <div class="toggleRow">
          <span>Reveal numbers in header</span>
          <input class="switch" id="revealHeader" type="checkbox">
        </div>
        <div class="toggleRow">
          <span>Reveal Thousands/Hundreds/Tens/Ones values</span>
          <input class="switch" id="revealPV" type="checkbox">
        </div>
        <div class="help">If OFF, pupils must type each digit (including 0) into the place-value boxes.</div>
      </div>

      <div class="field">
        <label>Disc sizes (20% smaller by default)</label>

        <div class="sliderRow">
          <input id="discBigRange" type="range" min="40" max="66" step="1" value="45">
          <span class="pill">Big discs: <span id="discBigVal">45</span>px</span>
        </div>

        <div class="sliderRow" style="margin-top:10px">
          <input id="discMedRange" type="range" min="36" max="62" step="1" value="42">
          <span class="pill">Medium: <span id="discMedVal">42</span>px</span>
        </div>

        <div class="sliderRow" style="margin-top:10px">
          <input id="discSmallRange" type="range" min="30" max="58" step="1" value="37">
          <span class="pill">Small: <span id="discSmallVal">37</span>px</span>
        </div>

        <div class="help">Hundreds (and other columns) will auto-shrink if needed to fit 5+4 discs neatly.</div>
      </div>

      <div class="field">
        <label>Quick reset (teacher)</label>
        <button class="btn" id="teacherClear">Clear pupil inputs</button>
      </div>
    </div>
  </aside>

  <script>
    const BASE_W = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--baseW')) || 980;
    const BASE_H = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--baseH')) || 690;
    const stage = document.getElementById('stage');

    const overlay = document.getElementById('overlay');
    const drawer = document.getElementById('drawer');

    function fitStage(){
      const pad = 20;
      const vw = Math.max(320, window.innerWidth - pad);
      const vh = Math.max(320, window.innerHeight - pad);

      const drawerOpen = document.body.classList.contains('drawer-open');
      const dw = drawerOpen ? drawer.getBoundingClientRect().width : 0;
      const availW = Math.max(320, vw - dw);

      const s = Math.min(availW / BASE_W, vh / BASE_H);
      stage.style.transform = `scale(${s})`;
    }
    window.addEventListener('resize', fitStage);
    window.addEventListener('orientationchange', fitStage);

    // numbers (1..9999)
    let leftNum = 3250;
    let rightNum = 2500;
    let revealHeaderNumbers = false;
    let revealPVNumbers = false;

    // header
    const hdrA = document.getElementById('hdrA');
    const hdrB = document.getElementById('hdrB');

    // disc areas
    const leftThEl = document.getElementById('leftThousands');
    const leftHundEl = document.getElementById('leftHundreds');
    const leftTensEl = document.getElementById('leftTens');
    const leftOnesEl = document.getElementById('leftOnes');

    const rightThEl = document.getElementById('rightThousands');
    const rightHundEl = document.getElementById('rightHundreds');
    const rightTensEl = document.getElementById('rightTens');
    const rightOnesEl = document.getElementById('rightOnes');

    // pv boxes
    const leftThVal = document.getElementById('leftThVal');
    const leftHundVal = document.getElementById('leftHundVal');
    const leftTensVal = document.getElementById('leftTensVal');
    const leftOnesVal = document.getElementById('leftOnesVal');

    const rightThVal = document.getElementById('rightThVal');
    const rightHundVal = document.getElementById('rightHundVal');
    const rightTensVal = document.getElementById('rightTensVal');
    const rightOnesVal = document.getElementById('rightOnesVal');

    // inequality inputs
    const gtA = document.getElementById('gtA');
    const gtB = document.getElementById('gtB');
    const ltA = document.getElementById('ltA');
    const ltB = document.getElementById('ltB');
    const msg = document.getElementById('msg');

    // teacher controls
    const setLeft = document.getElementById('setLeft');
    const setRight = document.getElementById('setRight');
    const applyBtn = document.getElementById('applyBtn');
    const randomBtn = document.getElementById('randomBtn');
    const revealHeader = document.getElementById('revealHeader');
    const revealPV = document.getElementById('revealPV');
    const teacherClear = document.getElementById('teacherClear');

    // size sliders
    const discBigRange = document.getElementById('discBigRange');
    const discMedRange = document.getElementById('discMedRange');
    const discSmallRange = document.getElementById('discSmallRange');
    const discBigVal = document.getElementById('discBigVal');
    const discMedVal = document.getElementById('discMedVal');
    const discSmallVal = document.getElementById('discSmallVal');

    // drawer buttons
    const openSettings = document.getElementById('openSettings');
    const openSettings2 = document.getElementById('openSettings2');
    const closeSettings = document.getElementById('closeSettings');

    // main buttons
    const checkBtn = document.getElementById('checkBtn');
    const clearBtn = document.getElementById('clearBtn');
    const quickRandomBtn = document.getElementById('quickRandomBtn');
    const quickHeaderBtn = document.getElementById('quickHeaderBtn');
    const quickPVBtn = document.getElementById('quickPVBtn');

    function clamp1to9999(n){
      n = Number(n);
      if (!Number.isFinite(n)) return 1;
      n = Math.round(n);
      if (n < 1) n = 1;
      if (n > 9999) n = 9999;
      return n;
    }

    function splitPlaces(n){
      return {
        th: Math.floor(n/1000),
        hund: Math.floor((n%1000)/100),
        tens: Math.floor((n%100)/10),
        ones: n % 10
      };
    }

    function sanitizeDigits(val, maxLen){
      const s = String(val ?? '').trim();
      if (!s) return '';
      return s.replace(/[^\d]/g,'').slice(0, maxLen);
    }

    function clearMarks(){
      [gtA,gtB,ltA,ltB].forEach(el=> el.classList.remove('good','bad'));
      [leftThVal,leftHundVal,leftTensVal,leftOnesVal,rightThVal,rightHundVal,rightTensVal,rightOnesVal]
        .forEach(el=> el.classList.remove('good','bad'));
      msg.textContent = '';
    }

    function mark(el, ok){
      el.classList.remove('good','bad');
      el.classList.add(ok ? 'good' : 'bad');
    }

    function makeDisc(kind, label){
      const d = document.createElement('div');
      d.className = `disc ${kind}`;
      const sp = document.createElement('span');
      sp.textContent = label;
      d.appendChild(sp);
      return d;
    }

    /* ✅ helper: read CSS var px */
    function getCssPx(varName, fallback){
      const v = getComputedStyle(document.documentElement).getPropertyValue(varName);
      const n = parseFloat(v);
      return Number.isFinite(n) ? n : fallback;
    }

    /* ✅ helper: fit disc size so 5+4 stacks never overflow */
    function fitDiscSizeForTwoCol(container, countL, countR, maxS){
      if ((countL <= 0 && countR <= 0) || !container) return maxS;

      const styles = getComputedStyle(container);
      const padX = (parseFloat(styles.paddingLeft)||0) + (parseFloat(styles.paddingRight)||0);
      const padY = (parseFloat(styles.paddingTop)||0) + (parseFloat(styles.paddingBottom)||0);

      const gapCol = getCssPx('--stackColGap', 10);
      const gapRow = getCssPx('--stackRowGap', 10);

      // width constraint (per column)
      const availW = Math.max(20, container.clientWidth - padX - gapCol);
      const maxByW = availW / 2;

      // height constraint (per column)
      const availH = Math.max(40, container.clientHeight - padY);
      const byH = (c)=>{
        if (c <= 0) return Infinity;
        return (availH - (c - 1) * gapRow) / c;
      };
      const maxByH = Math.min(byH(countL), byH(countR));

      const fit = Math.floor(Math.min(maxS, maxByW, maxByH));
      return Math.max(18, fit);
    }

    /* ✅ render discs with auto-fit (fixes hundreds overflow) */
    function renderDiscs(container, count, kind, labelText){
      container.innerHTML = '';

      const colL = document.createElement('div');
      colL.className = 'stackCol';
      const colR = document.createElement('div');
      colR.className = 'stackCol';
      container.appendChild(colL);
      container.appendChild(colR);

      const leftCount = Math.min(5, count);
      const rightCount = Math.max(0, count - 5);

      // max size from current column (driven by sliders)
      const currentDiscS = getComputedStyle(container).getPropertyValue('--discS');
      const maxS = Math.max(18, parseFloat(currentDiscS) || 40);

      // compute fit + apply as inline var
      const fitS = fitDiscSizeForTwoCol(container, leftCount, rightCount, maxS);
      container.style.setProperty('--discS', fitS + 'px');

      for (let i=0; i<leftCount; i++) colL.appendChild(makeDisc(kind, labelText));
      for (let i=0; i<rightCount; i++) colR.appendChild(makeDisc(kind, labelText));
    }

    function renderBlocksFor(n, thEl, hEl, tEl, oEl){
      const { th, hund, tens, ones } = splitPlaces(n);
      renderDiscs(thEl, th, 'th', '1000');
      renderDiscs(hEl, hund, 'h', '100');
      renderDiscs(tEl, tens, 't', '10');
      renderDiscs(oEl, ones, 'o', '1');
    }

    function applySizes(){
      const big = Math.max(40, Math.min(66, Number(discBigRange.value)));
      const med = Math.max(36, Math.min(62, Number(discMedRange.value)));
      const small = Math.max(30, Math.min(58, Number(discSmallRange.value)));

      document.documentElement.style.setProperty('--discBig', big + 'px');
      document.documentElement.style.setProperty('--discMed', med + 'px');
      document.documentElement.style.setProperty('--discSmall', small + 'px');

      discBigVal.textContent = big;
      discMedVal.textContent = med;
      discSmallVal.textContent = small;

      renderBlocksFor(leftNum, leftThEl, leftHundEl, leftTensEl, leftOnesEl);
      renderBlocksFor(rightNum, rightThEl, rightHundEl, rightTensEl, rightOnesEl);
    }

    function renderHeader(){
      hdrA.textContent = revealHeaderNumbers ? String(leftNum) : '???';
      hdrB.textContent = revealHeaderNumbers ? String(rightNum) : '???';
    }

    function setPVBox(el, mode, valueOrPlaceholder){
      el.classList.remove('editable');
      el.innerHTML = '';

      if (mode === 'reveal'){
        el.textContent = valueOrPlaceholder;
        return null;
      }

      el.classList.add('editable');
      const inp = document.createElement('input');
      inp.className = 'pvInput';
      inp.inputMode = 'numeric';
      inp.maxLength = 1;
      inp.placeholder = valueOrPlaceholder || '';
      inp.addEventListener('input', ()=>{
        const cleaned = sanitizeDigits(inp.value, 1);
        if (inp.value !== cleaned) inp.value = cleaned;
      });
      el.appendChild(inp);
      return inp;
    }

    function renderPV(){
      const L = splitPlaces(leftNum);
      const R = splitPlaces(rightNum);

      [leftThVal,leftHundVal,leftTensVal,leftOnesVal,rightThVal,rightHundVal,rightTensVal,rightOnesVal]
        .forEach(el=> el.classList.remove('good','bad'));

      if (revealPVNumbers){
        setPVBox(leftThVal,   'reveal', L.th);
        setPVBox(leftHundVal, 'reveal', L.hund);
        setPVBox(leftTensVal, 'reveal', L.tens);
        setPVBox(leftOnesVal, 'reveal', L.ones);

        setPVBox(rightThVal,  'reveal', R.th);
        setPVBox(rightHundVal,'reveal', R.hund);
        setPVBox(rightTensVal,'reveal', R.tens);
        setPVBox(rightOnesVal,'reveal', R.ones);

        renderPV._LTH = renderPV._LH = renderPV._LT = renderPV._LO = null;
        renderPV._RTH = renderPV._RH = renderPV._RT = renderPV._RO = null;
      } else {
        renderPV._LTH = setPVBox(leftThVal,   'edit', '');
        renderPV._LH  = setPVBox(leftHundVal, 'edit', '');
        renderPV._LT  = setPVBox(leftTensVal, 'edit', '');
        renderPV._LO  = setPVBox(leftOnesVal, 'edit', '');

        renderPV._RTH = setPVBox(rightThVal,  'edit', '');
        renderPV._RH  = setPVBox(rightHundVal,'edit', '');
        renderPV._RT  = setPVBox(rightTensVal,'edit', '');
        renderPV._RO  = setPVBox(rightOnesVal,'edit', '');
      }
    }

    function clearInputsOnly(){
      [gtA,gtB,ltA,ltB].forEach(el=> el.value = '');
      if (!revealPVNumbers){
        [renderPV._LTH, renderPV._LH, renderPV._LT, renderPV._LO, renderPV._RTH, renderPV._RH, renderPV._RT, renderPV._RO]
          .forEach(inp=>{ if (inp) inp.value = ''; });
      }
      clearMarks();
    }

    function syncQuickButtons(){
      quickHeaderBtn.classList.toggle('toggle-on', revealHeaderNumbers);
      quickPVBtn.classList.toggle('toggle-on', revealPVNumbers);

      quickHeaderBtn.textContent = revealHeaderNumbers ? 'Header: ON' : 'Header: OFF';
      quickPVBtn.textContent = revealPVNumbers ? 'Place values: ON' : 'Place values: OFF';
    }

    function renderAll(){
      renderHeader();
      renderBlocksFor(leftNum, leftThEl, leftHundEl, leftTensEl, leftOnesEl);
      renderBlocksFor(rightNum, rightThEl, rightHundEl, rightTensEl, rightOnesEl);
      renderPV();
      clearInputsOnly();
      syncQuickButtons();
    }

    function checkAnswers(){
      clearMarks();

      const L = splitPlaces(leftNum);
      const R = splitPlaces(rightNum);

      const big = Math.max(leftNum, rightNum);
      const small = Math.min(leftNum, rightNum);

      const gA = sanitizeDigits(gtA.value, 4);
      const gB = sanitizeDigits(gtB.value, 4);
      mark(gtA, gA !== '' && Number(gA) === big);
      mark(gtB, gB !== '' && Number(gB) === small);

      const lA = sanitizeDigits(ltA.value, 4);
      const lB = sanitizeDigits(ltB.value, 4);
      mark(ltA, lA !== '' && Number(lA) === small);
      mark(ltB, lB !== '' && Number(lB) === big);

      let pvOk = true;
      if (!revealPVNumbers){
        const lth = renderPV._LTH ? sanitizeDigits(renderPV._LTH.value, 1) : '';
        const lh  = renderPV._LH  ? sanitizeDigits(renderPV._LH.value, 1)  : '';
        const lt  = renderPV._LT  ? sanitizeDigits(renderPV._LT.value, 1)  : '';
        const lo  = renderPV._LO  ? sanitizeDigits(renderPV._LO.value, 1)  : '';

        const rth = renderPV._RTH ? sanitizeDigits(renderPV._RTH.value, 1) : '';
        const rh  = renderPV._RH  ? sanitizeDigits(renderPV._RH.value, 1)  : '';
        const rt  = renderPV._RT  ? sanitizeDigits(renderPV._RT.value, 1)  : '';
        const ro  = renderPV._RO  ? sanitizeDigits(renderPV._RO.value, 1)  : '';

        const okLTH = lth !== '' && Number(lth) === L.th;
        const okLH  = lh  !== '' && Number(lh)  === L.hund;
        const okLT  = lt  !== '' && Number(lt)  === L.tens;
        const okLO  = lo  !== '' && Number(lo)  === L.ones;

        const okRTH = rth !== '' && Number(rth) === R.th;
        const okRH  = rh  !== '' && Number(rh)  === R.hund;
        const okRT  = rt  !== '' && Number(rt)  === R.tens;
        const okRO  = ro  !== '' && Number(ro)  === R.ones;

        leftThVal.classList.add(okLTH ? 'good' : 'bad');
        leftHundVal.classList.add(okLH ? 'good' : 'bad');
        leftTensVal.classList.add(okLT ? 'good' : 'bad');
        leftOnesVal.classList.add(okLO ? 'good' : 'bad');

        rightThVal.classList.add(okRTH ? 'good' : 'bad');
        rightHundVal.classList.add(okRH ? 'good' : 'bad');
        rightTensVal.classList.add(okRT ? 'good' : 'bad');
        rightOnesVal.classList.add(okRO ? 'good' : 'bad');

        pvOk = okLTH && okLH && okLT && okLO && okRTH && okRH && okRT && okRO;
      }

      const compareOk =
        gtA.classList.contains('good') && gtB.classList.contains('good') &&
        ltA.classList.contains('good') && ltB.classList.contains('good');

      const ok = compareOk && pvOk;

      msg.textContent = ok
        ? '✅ Well done!'
        : (!revealPVNumbers && !pvOk)
          ? 'Try again. Fill in Thousands, Hundreds, Tens and Ones correctly.'
          : 'Try again. Use the unequal signs with the correct numbers.';
    }

    [gtA,gtB,ltA,ltB].forEach(inp=>{
      inp.addEventListener('input', ()=>{
        const cleaned = sanitizeDigits(inp.value, 4);
        if (inp.value !== cleaned) inp.value = cleaned;
      });
    });

    function ensureNotEqual(){
      if (leftNum === rightNum){
        rightNum = (rightNum === 9999) ? 9998 : rightNum + 1;
        setRight.value = rightNum;
      }
    }

    function applyNumbers(){
      leftNum = clamp1to9999(setLeft.value);
      rightNum = clamp1to9999(setRight.value);
      ensureNotEqual();
      renderAll();
      applySizes();
    }

    function randomizeNumbers(){
      const a = 1 + Math.floor(Math.random()*9999);
      let b = 1 + Math.floor(Math.random()*9999);
      if (b === a) b = (b === 9999) ? 9998 : b + 1;

      setLeft.value = a;
      setRight.value = b;
      applyNumbers();
    }

    function setRevealHeader(on){
      revealHeaderNumbers = !!on;
      revealHeader.checked = revealHeaderNumbers;
      renderHeader();
      syncQuickButtons();
    }
    function setRevealPV(on){
      revealPVNumbers = !!on;
      revealPV.checked = revealPVNumbers;
      renderPV();
      clearInputsOnly();
      syncQuickButtons();
    }

    revealHeader.addEventListener('change', ()=> setRevealHeader(revealHeader.checked));
    revealPV.addEventListener('change', ()=> setRevealPV(revealPV.checked));

    applyBtn.addEventListener('click', applyNumbers);
    randomBtn.addEventListener('click', randomizeNumbers);
    teacherClear.addEventListener('click', clearInputsOnly);

    checkBtn.addEventListener('click', checkAnswers);
    clearBtn.addEventListener('click', clearInputsOnly);
    quickRandomBtn.addEventListener('click', randomizeNumbers);
    quickHeaderBtn.addEventListener('click', ()=> setRevealHeader(!revealHeaderNumbers));
    quickPVBtn.addEventListener('click', ()=> setRevealPV(!revealPVNumbers));

    discBigRange.addEventListener('input', applySizes);
    discMedRange.addEventListener('input', applySizes);
    discSmallRange.addEventListener('input', applySizes);

    function openDrawer(){
      overlay.classList.add('show');
      drawer.classList.add('show');
      overlay.setAttribute('aria-hidden','false');
      document.body.classList.add('drawer-open');
      fitStage();
      applySizes();
    }
    function closeDrawer(){
      overlay.classList.remove('show');
      drawer.classList.remove('show');
      overlay.setAttribute('aria-hidden','true');
      document.body.classList.remove('drawer-open');
      fitStage();
      applySizes();
    }
    openSettings.addEventListener('click', openDrawer);
    openSettings2.addEventListener('click', openDrawer);
    closeSettings.addEventListener('click', closeDrawer);
    overlay.addEventListener('click', closeDrawer);
    window.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') closeDrawer(); });

    // Init
    setLeft.value = leftNum;
    setRight.value = rightNum;

    fitStage();
    applySizes();
    renderAll();
    requestAnimationFrame(()=> applySizes());
  </script>
<script src="https://cdn.counter.dev/script.js" data-id="825e93b6-ce99-40ef-8bcc-125f13297433" data-utcoffset="8"></script>
</body>
</html>
